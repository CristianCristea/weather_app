var cities=[],substringMatcher=function(e){return function(t,a){var n;n=[],substrRegex=new RegExp(t,"i"),$.each(e,function(e,t){substrRegex.test(t)&&n.push(t)}),a(n)}};$.getJSON("city.list.json",function(e){$.each(e,function(e,t){cities.push(t.name)})}).fail(function(e,t,a){var n=t+", "+a;console.log("Request Failed: "+n)}),$("#the-basics .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"cities",source:substringMatcher(cities)}),jQuery(document).ready(function(e){var t,a=e("#search"),n={"default":["default1","default2","default3","default4","default5","default6","default7"],rain:["rain1","rain2","rain3","rain4","rain5"],snow:["snow1","snow2","snow3","snow4"]},r=function(e){var t=new Date(1e3*e),a=t.getHours()<10?"0"+t.getHours():t.getHours(),n=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),r=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),o=a+":"+n+":"+r;return o},o=function(e){var t=new Date(1e3*e),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=t.getFullYear(),r=a[t.getMonth()],o=t.getDate(),i=o+" "+r+" "+n;return i},i=function(e,t){return Math.floor(Math.random()*(t-e)+e)},s=function(e,t){return e>=200&&e<600?n.rain[i(0,t.rain.length)]:e>=600&&e<700?n.snow[i(0,t.snow.length)]:n["default"][i(0,t["default"].length)]},l=function(){return e("body").css("background","url(img/"+s(t,n)+".jpg)")};Handlebars.registerHelper("time",function(e){e=Handlebars.Utils.escapeExpression(e);var t=r(e);return new Handlebars.SafeString(t)}),Handlebars.registerHelper("date",function(e){e=Handlebars.Utils.escapeExpression(e);var t=o(e);return new Handlebars.SafeString(t)}),Handlebars.registerHelper("displayWeatherIcon",function(e,t){e=Handlebars.Utils.escapeExpression(e),t=Handlebars.Utils.escapeExpression(t);var a='<img src="http://openweathermap.org/img/w/'+e+'.png" alt="'+t+'" class="weather-icon">';return new Handlebars.SafeString(a)});var c=function(e,t,a){var n=t+", "+a;console.log("Request Failed: "+n)},u=function(a){var r=Handlebars.templates.display_weather,o=r(a);e("ul.list").html(o),l(t,n)};a.on("typeahead:selected",function(n,r){var o=r,i="http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba&callback=",s={mode:"JSON",units:"metric",q:o};e.ajax(i,{dataType:"json",data:s,success:function(e){u(e),a.val(""),t=e.weather[0].id,console.log(t)},error:c})}),a.on("click",function(){a.val(""),e("ul.list").empty()}),e("#home").on("click",function(e){e.preventDefault(),location.reload()}),e("#currentLocation").on("click",function(n){n.preventDefault(),alert("Current location functionality disabled for the moment."),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(n){var r=n.coords,o="http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba",i={lat:r.latitude,lon:r.longitude,units:"metric"};e.ajax(o,{dataType:"json",data:i,success:function(e){u(e),a.val(""),t=e.weather[0].id,console.log(t)},error:c})}):alert("Location not available, please upgrade your browser")})});