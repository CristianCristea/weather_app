var cities=[],substringMatcher=function(e){return function(a,t){var n;n=[],substrRegex=new RegExp(a,"i"),$.each(e,function(e,a){substrRegex.test(a)&&n.push(a)}),t(n)}};$.getJSON("city.list.json",function(e){$.each(e,function(e,a){cities.push(a.name)})}).fail(function(e,a,t){var n=a+", "+t;console.log("Request Failed: "+n)}),$("#the-basics .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"cities",source:substringMatcher(cities)}),jQuery(document).ready(function(e){var a=e("#search"),t=function(e){var a=new Date(1e3*e),t=a.getHours()<10?"0"+a.getHours():a.getHours(),n=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),r=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds(),i=t+":"+n+":"+r;return i},n=function(e){var a=new Date(1e3*e),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=a.getFullYear(),r=t[a.getMonth()],i=a.getDate(),s=i+" "+r+" "+n;return s};Handlebars.registerHelper("time",function(e){e=Handlebars.Utils.escapeExpression(e);var a=t(e);return new Handlebars.SafeString(a)}),Handlebars.registerHelper("date",function(e){e=Handlebars.Utils.escapeExpression(e);var a=n(e);return new Handlebars.SafeString(a)}),Handlebars.registerHelper("displayWeatherIcon",function(e,a){e=Handlebars.Utils.escapeExpression(e),a=Handlebars.Utils.escapeExpression(a);var t='<img src="http://openweathermap.org/img/w/'+e+'.png" alt="'+a+'" class="weather-icon">';return new Handlebars.SafeString(t)});var r=function(e,a,t){var n=a+", "+t;console.log("Request Failed: "+n)},i=function(a){var t=Handlebars.templates.display_weather,n=t(a);e("ul.list").html(n)};a.on("typeahead:selected",function(t,n){var s=n,o="http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba&callback=",c={mode:"JSON",units:"metric",q:s};e.ajax(o,{dataType:"json",data:c,success:function(e){i(e),a.val("")},error:r})}),a.on("click",function(){a.val(""),e("ul.list").empty()}),e("#home").on("click",function(e){e.preventDefault(),location.reload()}),e("#currentLocation").on("click",function(a){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(a){var t=a.coords,n="http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba",s={lat:t.latitude,lon:t.longitude,units:"metric"};e.ajax(n,{dataType:"json",data:s,success:i,error:r})}):alert("Location not available, please upgrade your browser")})});