var cities=[],substringMatcher=function(e){return function(a,t){var n;n=[],substrRegex=new RegExp(a,"i"),$.each(e,function(e,a){substrRegex.test(a)&&n.push(a)}),t(n)}};$.getJSON("city.list.json",function(e){$.each(e,function(e,a){cities.push(a.name)})}).fail(function(e,a,t){var n=a+", "+t;console.log("Request Failed: "+n)}),$("#the-basics .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"cities",source:substringMatcher(cities)}),jQuery(document).ready(function(e){var a,t=e("#search"),n={"default":["default1","default2","default3","default4","default5","default6","default7"],rain:["rain1","rain2","rain3","rain4","rain5"],snow:["snow1","snow2","snow3","snow4"]},r=function(e){var a=new Date(1e3*e),t=a.getHours()<10?"0"+a.getHours():a.getHours(),n=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),r=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds(),i=t+":"+n+":"+r;return i},i=function(e){var a=new Date(1e3*e),t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=a.getFullYear(),r=t[a.getMonth()],i=a.getDate(),o=i+" "+r+" "+n;return o},o=function(e,a){return Math.floor(Math.random()*(a-e)+e)},s=function(e,a){return e>=200&&e<600?n.rain[o(0,a.rain.length)]:e>=600&&e<700?n.snow[o(0,a.snow.length)]:n["default"][o(0,a["default"].length)]},l=function(){return e("body").css("background","url(img/"+s(a,n)+".jpg)")};Handlebars.registerHelper("time",function(e){e=Handlebars.Utils.escapeExpression(e);var a=r(e);return new Handlebars.SafeString(a)}),Handlebars.registerHelper("date",function(e){e=Handlebars.Utils.escapeExpression(e);var a=i(e);return new Handlebars.SafeString(a)}),Handlebars.registerHelper("displayWeatherIcon",function(e,a){e=Handlebars.Utils.escapeExpression(e),a=Handlebars.Utils.escapeExpression(a);var t='<img src="http://openweathermap.org/img/w/'+e+'.png" alt="'+a+'" class="weather-icon">';return new Handlebars.SafeString(t)});var c=function(e,a,t){var n=a+", "+t;console.log("Request Failed: "+n)},u=function(t){var r=Handlebars.templates.display_weather,i=r(t);e("ul.list").html(i),l(a,n)};t.on("typeahead:selected",function(n,r){var i=r,o="http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba&callback=",s={mode:"JSON",units:"metric",q:i};e.ajax(o,{dataType:"json",data:s,success:function(e){u(e),t.val(""),a=e.weather[0].id,console.log(a)},error:c})}),t.on("click",function(){t.val(""),e("ul.list").empty()}),e("#home").on("click",function(e){e.preventDefault(),location.reload()}),e("#currentLocation").on("click",function(n){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(n){var r=n.coords,i="http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba",o={lat:r.latitude,lon:r.longitude,units:"metric"};e.ajax(i,{dataType:"json",data:o,success:function(e){u(e),t.val(""),a=e.weather[0].id,console.log(a)},error:c})}):alert("Location not available, please upgrade your browser")})});