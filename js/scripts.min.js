var cities=[],substringMatcher=function(e){return function(t,a){var n;n=[],substrRegex=new RegExp(t,"i"),$.each(e,function(e,t){substrRegex.test(t)&&n.push(t)}),a(n)}};$.getJSON("city.list.json",function(e){$.each(e,function(e,t){cities.push(t.name)})}).fail(function(e,t,a){var n=t+", "+a;console.log("Request Failed: "+n)}),$("#the-basics .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"cities",source:substringMatcher(cities)}),jQuery(document).ready(function(e){var t,a=e("#search"),n={"default":["default1","default2","default3","default4","default5","default6","default7"],rain:["rain1","rain2","rain3","rain4","rain5"],snow:["snow1","snow2","snow3","snow4"]},r=function(e){var t=new Date(1e3*e),a=t.getHours()<10?"0"+t.getHours():t.getHours(),n=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),r=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),s=a+":"+n+":"+r;return s},s=function(e){var t=new Date(1e3*e),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=t.getFullYear(),r=a[t.getMonth()],s=t.getDate(),i=s+" "+r+" "+n;return i},i=function(e,t){return Math.floor(Math.random()*(t-e)+e)},o=function(e,t){return e>=200&&e<600?n.rain[i(0,t.rain.length)]:e>=600&&e<700?n.snow[i(0,t.snow.length)]:n["default"][i(0,t["default"].length)]},c=function(){return e("body").css("background","rgba(0, 0, 0, .8) url(img/"+o(t,n)+".jpg)")};Handlebars.registerHelper("time",function(e){e=Handlebars.Utils.escapeExpression(e);var t=r(e);return new Handlebars.SafeString(t)}),Handlebars.registerHelper("date",function(e){e=Handlebars.Utils.escapeExpression(e);var t=s(e);return new Handlebars.SafeString(t)}),Handlebars.registerHelper("displayWeatherIcon",function(e,t){e=Handlebars.Utils.escapeExpression(e),t=Handlebars.Utils.escapeExpression(t);var a='<img src="https://cors-anywhere.herokuapp.com/http://openweathermap.org/img/w/'+e+'.png" alt="'+t+'" class="weather-icon">';return new Handlebars.SafeString(a)});var u=function(e,t,a){var n=t+", "+a;console.log("Request Failed: "+n)},l=function(a){var r=Handlebars.templates.display_weather,s=r(a);e("ul.list").html(s),c(t,n)};a.on("typeahead:selected",function(n,r){var s=r,i="https://cors-anywhere.herokuapp.com/http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba&callback=",o={mode:"JSON",units:"metric",q:s};e.ajax(i,{dataType:"json",data:o,success:function(e){l(e),a.val(""),t=e.weather[0].id,console.log(t)},error:u})}),a.on("click",function(){a.val(""),e("ul.list").empty()}),e("#home").on("click",function(e){e.preventDefault(),location.reload()}),e("#currentLocation").on("click",function(n){n.preventDefault();var r="https://cors-anywhere.herokuapp.com/http://api.openweathermap.org/data/2.5/weather?appid=68d06ff44fb97dc7a6ea98b54f8374ba";e.ajax("https://ipinfo.io/json",{success:function(n){var s={q:n.city,units:"metric"};e.ajax(r,{dataType:"json",data:s,success:function(e){l(e),a.val(""),t=e.weather[0].id},error:function(e){console.dir(e)}})}})})});